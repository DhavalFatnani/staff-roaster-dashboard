/**
 * readme.cursor
 * 
 * Purpose: Comprehensive documentation for the Staff Roster Dashboard
 * 
 * Run notes:
 * - This is the main README.md content
 * - Copy this to README.md in your project root
 * - Update with your specific deployment URLs and credentials
 */

# Staff Roster Dashboard

A production-ready single-page web application for Store Managers (SM) and Shift In Charge (SI) to plan daily rosters, assign staff to shifts, allocate tasks, enforce coverage rules, and perform full CRUD operations on user accounts and role definitions.

## Features

- **User & Role Management**: Full CRUD operations on users and roles with permission-based access control
- **Roster Planning**: Create and manage daily rosters with two fixed shifts (morning/evening)
- **Task Allocation**: Assign tasks to staff members based on experience levels
- **Coverage Validation**: Automatic validation of roster assignments against business rules
- **Export & Share**: Export rosters to CSV/PDF and share via email or Slack
- **Audit Logging**: Complete audit trail of all user actions
- **Bulk Operations**: Bulk import users via CSV, bulk assign week-offs, and more

## Tech Stack

- **Frontend**: React + TypeScript, Tailwind CSS
- **Backend**: Node.js/Express or Next.js API routes
- **Database**: PostgreSQL (or any SQL/NoSQL database)
- **Testing**: Jest, React Testing Library, Playwright
- **Build Tool**: Next.js or Vite

## Getting Started

### Prerequisites

- Node.js 18.x or higher
- PostgreSQL 14+ (or your preferred database)
- npm or yarn

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd staff-roaster-dashboard
```

2. Install dependencies:
```bash
npm install
```

3. Set up environment variables:
```bash
cp .env.example .env
# Edit .env with your configuration
```

4. Run database migrations:
```bash
npm run db:migrate
```

5. Seed the database (optional):
```bash
npm run db:seed
```

6. Start the development server:
```bash
npm run dev
```

The application will be available at `http://localhost:3000`.

## Project Structure

```
staff-roaster-dashboard/
├── schema.cursor          # TypeScript type definitions
├── seed.cursor            # Seed data for development
├── validators.cursor      # Validation functions
├── api.cursor             # API route handlers
├── components.cursor      # React UI components
├── pages.cursor           # Page components
├── export.cursor          # CSV/PDF export utilities
├── audit.cursor           # Audit log model and viewer
├── migrations.cursor      # Database migration scripts
├── workflows.cursor       # User stories and test scenarios
├── tests.cursor           # Unit and E2E tests
├── ui-styles.cursor       # Tailwind config and design tokens
├── ci.cursor              # CI/CD configuration
└── readme.cursor          # This file
```

## User Roles & Permissions

### Store Manager (SM)
- **Full CRUD** on all users, roles, shift definitions, settings, and roster templates
- Can publish, export, and share rosters
- Can delete users (with reassignment options)
- Cannot delete the last SM account

### Shift In Charge (SI)
- **CRUD** for staff and ad-hoc PP accounts within their store
- Can assign roles (except cannot modify SM accounts)
- Can create and modify rosters for their shifts
- Can manage task assignments
- Cannot delete or demote SM users (configurable in settings)

### Inventory Executive (IE)
- Regular role with view-only access to rosters
- Can view assigned tasks

### Picker Packer (PP)
- Two types: `warehouse` (in-store) and `adHoc` (temporary)
- View-only access to assigned rosters

## Permission Matrix

| Permission | SM | SI | IE | PP |
|------------|----|----|----|----|
| CRUD_USER | ✓ | ✓* | ✗ | ✗ |
| CRUD_ROLE | ✓ | ✗ | ✗ | ✗ |
| CREATE_ROSTER | ✓ | ✓ | ✗ | ✗ |
| MODIFY_ROSTER | ✓ | ✓ | ✗ | ✗ |
| PUBLISH_ROSTER | ✓ | ✗** | ✗ | ✗ |
| ASSIGN_SHIFT | ✓ | ✓ | ✗ | ✗ |
| EXPORT_ROSTER | ✓ | ✓ | ✗ | ✗ |
| SHARE_ROSTER | ✓ | ✗ | ✗ | ✗ |
| VIEW_ROSTER | ✓ | ✓ | ✓ | ✓ |
| VIEW_AUDIT_LOG | ✓ | ✗ | ✗ | ✗ |

\* SI can only CRUD staff and ad-hoc PP accounts, not SM users  
\** SI can publish if enabled in store settings

## Business Rules

### Roster Constraints
- Two shifts per day: Morning (08:00-17:00) and Evening (17:00-02:00)
- Each shift is exactly 9 hours
- Staff can only be assigned to one shift per day
- Minimum staff per shift: 3 (configurable)
- Maximum staff per shift: 12 (configurable)
- Staff cannot be assigned on their week-off days

### User Management
- Employee IDs must be unique
- Deleting a user requires handling future roster assignments (reassign or mark vacant)
- At least one SM must exist per store
- System roles cannot be deleted
- Roles with assigned users cannot be deleted (must reassign first)

### Validation Rules
- Email format validation
- Week-off day validation (0-6, no duplicates)
- Roster coverage validation before publishing
- Shift conflict detection

## API Endpoints

### Users
- `GET /api/users` - List users (paginated)
- `GET /api/users/:id` - Get user by ID
- `POST /api/users` - Create user
- `PUT /api/users/:id` - Update user
- `DELETE /api/users/:id` - Delete user (soft delete)
- `POST /api/users/bulk-import` - Bulk import users from CSV

### Roles
- `GET /api/roles` - List roles
- `POST /api/roles` - Create role
- `PUT /api/roles/:id` - Update role
- `DELETE /api/roles/:id` - Delete role

### Rosters
- `GET /api/rosters` - List rosters
- `POST /api/rosters` - Create/update roster
- `POST /api/rosters/validate` - Validate roster assignments
- `POST /api/rosters/:id/publish` - Publish roster
- `POST /api/rosters/export` - Export rosters (CSV/PDF)
- `POST /api/rosters/share` - Share rosters (email/Slack)

### Audit
- `GET /api/audit-logs` - Query audit logs

## CSV Import Format

Example CSV for bulk user import:

```csv
employeeId,firstName,lastName,email,phone,roleId,experienceLevel,ppType,weekOffs,defaultShiftPreference
PP-ADHOC-006,Chris,Helper,chris.helper@example.com,+1-555-5006,role-temp-pp,fresher,adHoc,0,morning
PP-ADHOC-007,Dana,Worker,dana.worker@example.com,+1-555-5007,role-temp-pp,fresher,adHoc,6,evening
```

**Notes:**
- `weekOffs`: Comma-separated day numbers (0=Sunday, 6=Saturday)
- `roleId`: Must exist in roles table
- `ppType`: Required only for PICKER_PACKER roles
- `defaultShiftPreference`: Optional, 'morning' or 'evening'

## Configuration

### Store Settings

Permission overrides for SI can be configured in store settings:

```typescript
{
  siCanDeleteStaff: true,
  siCanModifySM: false,  // Should be false by default
  siCanPublishRoster: false,  // Can be enabled per store
  siPermissions: [
    Permission.VIEW_OWN_STAFF,
    Permission.CRUD_USER,
    Permission.ASSIGN_SHIFT,
    // ... more permissions
  ]
}
```

### Environment Variables

See `.env.example` for all required environment variables:

- `DATABASE_URL` - Database connection string
- `JWT_SECRET` - Secret for JWT tokens
- `SMTP_*` - Email configuration
- `SLACK_WEBHOOK_URL` - Slack integration (optional)

## Testing

### Unit Tests
```bash
npm run test:unit
```

### E2E Tests
```bash
npm run test:e2e
```

### Coverage
```bash
npm run test:coverage
```

## Deployment

### Production Build
```bash
npm run build
npm start
```

### Docker
```bash
docker-compose up -d
```

### Environment-Specific Configs
- Development: `.env.development`
- Staging: `.env.staging`
- Production: `.env.production`

## Troubleshooting

### Common Issues

1. **Database connection errors**
   - Verify `DATABASE_URL` in `.env`
   - Ensure database is running and accessible

2. **Permission denied errors**
   - Check user role and permissions
   - Verify store settings allow the action

3. **Roster validation failures**
   - Check week-off assignments
   - Verify minimum staff requirements
   - Ensure no duplicate assignments

4. **CSV import errors**
   - Verify CSV format matches expected structure
   - Check for duplicate employee IDs
   - Ensure role IDs exist

## Security Considerations

- All API routes require authentication
- Permission checks are enforced on both client and server
- User passwords are hashed (use bcrypt or similar)
- Soft delete for users to maintain roster history
- Audit logging for compliance
- Input validation on all user inputs
- SQL injection prevention (use parameterized queries)

## TODOs & Future Enhancements

- [ ] Email/Slack integration implementation
- [ ] SMS notifications for roster changes
- [ ] Mobile app (React Native)
- [ ] Advanced reporting and analytics
- [ ] Integration with HR systems
- [ ] Multi-language support
- [ ] Dark mode
- [ ] Offline support (PWA)

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## License

[Your License Here]

## Support

For issues and questions:
- GitHub Issues: [repository-url]/issues
- Email: support@example.com

## Acknowledgments

- Built with React, TypeScript, and Tailwind CSS
- Database migrations use PostgreSQL
- Testing with Jest and Playwright

---

**Note**: This is a production-ready template. Replace placeholder values (URLs, credentials, etc.) with your actual configuration before deployment.
