/**
 * components.cursor
 * 
 * Purpose: React components for the Staff Roster Dashboard UI
 * 
 * Run notes:
 * - These are TypeScript React components using Tailwind CSS
 * - Import from './schema' for types
 * - Use React hooks (useState, useEffect) for state management
 * - Components are designed to be reusable and accessible
 * - Replace API calls with your actual API client
 */

import React, { useState, useEffect } from 'react';
import {
  User,
  Role,
  Roster,
  RosterSlot,
  CreateUserRequest,
  UpdateUserRequest,
  CreateRoleRequest,
  UpdateRoleRequest,
  Permission,
  ExperienceLevel,
  PPType,
  ShiftType,
  DeleteUserResult
} from './schema';

// ============================================================================
// User Management Components
// ============================================================================

/**
 * UserForm - Create/Edit user modal
 */
interface UserFormProps {
  user?: User;
  roles: Role[];
  onSubmit: (data: CreateUserRequest | UpdateUserRequest) => Promise<void>;
  onCancel: () => void;
  isOpen: boolean;
}

export function UserForm({ user, roles, onSubmit, onCancel, isOpen }: UserFormProps) {
  const [formData, setFormData] = useState<CreateUserRequest>({
    employeeId: user?.employeeId || '',
    firstName: user?.firstName || '',
    lastName: user?.lastName || '',
    email: user?.email || '',
    phone: user?.phone || '',
    roleId: user?.roleId || '',
    experienceLevel: user?.experienceLevel || ExperienceLevel.FRESHER,
    ppType: user?.ppType,
    weekOffs: user?.weekOffs || [],
    defaultShiftPreference: user?.defaultShiftPreference
  });

  const [errors, setErrors] = useState<Record<string, string>>({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const selectedRole = roles.find(r => r.id === formData.roleId);
  const isPPRole = selectedRole?.name.includes('Picker Packer');

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setErrors({});
    setIsSubmitting(true);

    try {
      await onSubmit(formData);
    } catch (error: any) {
      setErrors({ submit: error.message || 'Failed to save user' });
    } finally {
      setIsSubmitting(false);
    }
  };

  const toggleWeekOff = (day: number) => {
    setFormData(prev => ({
      ...prev,
      weekOffs: prev.weekOffs.includes(day)
        ? prev.weekOffs.filter(d => d !== day)
        : [...prev.weekOffs, day]
    }));
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4">
            {user ? 'Edit User' : 'Create New User'}
          </h2>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Employee ID *</label>
                <input
                  type="text"
                  value={formData.employeeId}
                  onChange={(e) => setFormData(prev => ({ ...prev, employeeId: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                  disabled={!!user}
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Role *</label>
                <select
                  value={formData.roleId}
                  onChange={(e) => setFormData(prev => ({ ...prev, roleId: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                >
                  <option value="">Select role</option>
                  {roles.map(role => (
                    <option key={role.id} value={role.id}>{role.name}</option>
                  ))}
                </select>
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">First Name *</label>
                <input
                  type="text"
                  value={formData.firstName}
                  onChange={(e) => setFormData(prev => ({ ...prev, firstName: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Last Name *</label>
                <input
                  type="text"
                  value={formData.lastName}
                  onChange={(e) => setFormData(prev => ({ ...prev, lastName: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Email *</label>
                <input
                  type="email"
                  value={formData.email}
                  onChange={(e) => setFormData(prev => ({ ...prev, email: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                />
              </div>

              <div>
                <label className="block text-sm font-medium mb-1">Phone</label>
                <input
                  type="tel"
                  value={formData.phone || ''}
                  onChange={(e) => setFormData(prev => ({ ...prev, phone: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                />
              </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Experience Level *</label>
                <select
                  value={formData.experienceLevel}
                  onChange={(e) => setFormData(prev => ({ ...prev, experienceLevel: e.target.value as ExperienceLevel }))}
                  className="w-full px-3 py-2 border rounded-md"
                  required
                >
                  <option value={ExperienceLevel.FRESHER}>Fresher</option>
                  <option value={ExperienceLevel.EXPERIENCED}>Experienced</option>
                </select>
              </div>

              {isPPRole && (
                <div>
                  <label className="block text-sm font-medium mb-1">PP Type *</label>
                  <select
                    value={formData.ppType || ''}
                    onChange={(e) => setFormData(prev => ({ ...prev, ppType: e.target.value as PPType }))}
                    className="w-full px-3 py-2 border rounded-md"
                    required
                  >
                    <option value="">Select type</option>
                    <option value={PPType.WAREHOUSE}>Warehouse</option>
                    <option value={PPType.AD_HOC}>Ad-Hoc</option>
                  </select>
                </div>
              )}
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">Week Offs</label>
              <div className="flex gap-2 flex-wrap">
                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map((day, idx) => (
                  <button
                    key={idx}
                    type="button"
                    onClick={() => toggleWeekOff(idx)}
                    className={`px-4 py-2 rounded-md ${
                      formData.weekOffs.includes(idx)
                        ? 'bg-blue-600 text-white'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    {day}
                  </button>
                ))}
              </div>
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Default Shift Preference</label>
              <select
                value={formData.defaultShiftPreference || ''}
                onChange={(e) => setFormData(prev => ({ ...prev, defaultShiftPreference: e.target.value as ShiftType || undefined }))}
                className="w-full px-3 py-2 border rounded-md"
              >
                <option value="">No preference</option>
                <option value={ShiftType.MORNING}>Morning</option>
                <option value={ShiftType.EVENING}>Evening</option>
              </select>
            </div>

            {!user && (
              <div className="flex items-center">
                <input
                  type="checkbox"
                  id="sendInvite"
                  checked={formData.sendInvite || false}
                  onChange={(e) => setFormData(prev => ({ ...prev, sendInvite: e.target.checked }))}
                  className="mr-2"
                />
                <label htmlFor="sendInvite" className="text-sm">Send invitation email</label>
              </div>
            )}

            {errors.submit && (
              <div className="text-red-600 text-sm">{errors.submit}</div>
            )}

            <div className="flex justify-end gap-3 pt-4">
              <button
                type="button"
                onClick={onCancel}
                className="px-4 py-2 border rounded-md hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isSubmitting}
                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
              >
                {isSubmitting ? 'Saving...' : user ? 'Update' : 'Create'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

/**
 * StaffCard - Display user card in staff directory
 */
interface StaffCardProps {
  user: User & { role?: Role };
  onEdit: (user: User) => void;
  onDelete: (user: User) => void;
  canEdit: boolean;
  canDelete: boolean;
}

export function StaffCard({ user, onEdit, onDelete, canEdit, canDelete }: StaffCardProps) {
  return (
    <div className="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow">
      <div className="flex justify-between items-start">
        <div>
          <h3 className="font-semibold text-lg">
            {user.firstName} {user.lastName}
          </h3>
          <p className="text-sm text-gray-600">{user.employeeId}</p>
          <p className="text-sm text-gray-500">{user.role?.name || 'No role'}</p>
          <div className="mt-2 flex gap-2">
            <span className={`px-2 py-1 text-xs rounded ${
              user.experienceLevel === ExperienceLevel.EXPERIENCED
                ? 'bg-green-100 text-green-800'
                : 'bg-blue-100 text-blue-800'
            }`}>
              {user.experienceLevel}
            </span>
            {user.ppType && (
              <span className="px-2 py-1 text-xs rounded bg-gray-100 text-gray-800">
                {user.ppType}
              </span>
            )}
          </div>
        </div>
        <div className="flex gap-2">
          {canEdit && (
            <button
              onClick={() => onEdit(user)}
              className="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200"
            >
              Edit
            </button>
          )}
          {canDelete && (
            <button
              onClick={() => onDelete(user)}
              className="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200"
            >
              Delete
            </button>
          )}
        </div>
      </div>
      <div className="mt-3 text-xs text-gray-500">
        <p>Email: {user.email}</p>
        {user.phone && <p>Phone: {user.phone}</p>}
        <p>Week Offs: {user.weekOffs.map(d => ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d]).join(', ') || 'None'}</p>
      </div>
    </div>
  );
}

/**
 * BulkImportModal - CSV import modal
 */
interface BulkImportModalProps {
  isOpen: boolean;
  onClose: () => void;
  onImport: (csvText: string) => Promise<void>;
}

export function BulkImportModal({ isOpen, onClose, onImport }: BulkImportModalProps) {
  const [csvText, setCsvText] = useState('');
  const [isImporting, setIsImporting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const handleImport = async () => {
    setError(null);
    setIsImporting(true);
    try {
      await onImport(csvText);
      setCsvText('');
      onClose();
    } catch (err: any) {
      setError(err.message || 'Import failed');
    } finally {
      setIsImporting(false);
    }
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4">Bulk Import Users</h2>
          <p className="text-sm text-gray-600 mb-4">
            Paste CSV data. Format: employeeId,firstName,lastName,email,phone,roleId,experienceLevel,ppType,weekOffs,defaultShiftPreference
          </p>
          <textarea
            value={csvText}
            onChange={(e) => setCsvText(e.target.value)}
            className="w-full h-64 px-3 py-2 border rounded-md font-mono text-sm"
            placeholder="PP-ADHOC-006,Chris,Helper,chris.helper@example.com,+1-555-5006,role-temp-pp,fresher,adHoc,0,morning"
          />
          {error && <div className="mt-2 text-red-600 text-sm">{error}</div>}
          <div className="flex justify-end gap-3 mt-4">
            <button
              onClick={onClose}
              className="px-4 py-2 border rounded-md hover:bg-gray-50"
            >
              Cancel
            </button>
            <button
              onClick={handleImport}
              disabled={!csvText.trim() || isImporting}
              className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
            >
              {isImporting ? 'Importing...' : 'Import'}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

/**
 * DeleteUserConfirmModal - Confirmation modal with impact preview
 */
interface DeleteUserConfirmModalProps {
  isOpen: boolean;
  user: User | null;
  deleteResult: DeleteUserResult | null;
  onConfirm: (reassignTo?: string, confirmVacancy?: boolean) => void;
  onCancel: () => void;
}

export function DeleteUserConfirmModal({
  isOpen,
  user,
  deleteResult,
  onConfirm,
  onCancel
}: DeleteUserConfirmModalProps) {
  const [reassignTo, setReassignTo] = useState('');
  const [confirmVacancy, setConfirmVacancy] = useState(false);

  if (!isOpen || !user || !deleteResult) return null;

  const hasImpactedRosters = deleteResult.impactedRosters.length > 0;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4 text-red-600">Confirm User Deletion</h2>
          <p className="mb-4">
            Are you sure you want to delete <strong>{user.firstName} {user.lastName}</strong> ({user.employeeId})?
          </p>

          {!deleteResult.allowed && (
            <div className="bg-red-50 border border-red-200 rounded p-4 mb-4">
              <p className="text-red-800">{deleteResult.reason}</p>
            </div>
          )}

          {hasImpactedRosters && (
            <div className="bg-yellow-50 border border-yellow-200 rounded p-4 mb-4">
              <p className="font-semibold mb-2">
                This user has {deleteResult.impactedRosters.length} future roster assignment(s):
              </p>
              <ul className="list-disc list-inside text-sm space-y-1">
                {deleteResult.impactedRosters.slice(0, 5).map((roster, idx) => (
                  <li key={idx}>
                    {roster.date} - {roster.shiftType} shift
                  </li>
                ))}
                {deleteResult.impactedRosters.length > 5 && (
                  <li>...and {deleteResult.impactedRosters.length - 5} more</li>
                )}
              </ul>
              <div className="mt-4 space-y-2">
                <div>
                  <label className="block text-sm font-medium mb-1">Reassign to user ID (optional):</label>
                  <input
                    type="text"
                    value={reassignTo}
                    onChange={(e) => setReassignTo(e.target.value)}
                    className="w-full px-3 py-2 border rounded-md"
                    placeholder="Enter user ID to reassign slots"
                  />
                </div>
                <div className="flex items-center">
                  <input
                    type="checkbox"
                    id="confirmVacancy"
                    checked={confirmVacancy}
                    onChange={(e) => setConfirmVacancy(e.target.checked)}
                    className="mr-2"
                  />
                  <label htmlFor="confirmVacancy" className="text-sm">
                    Mark slots as vacant instead of reassigning
                  </label>
                </div>
              </div>
            </div>
          )}

          <div className="flex justify-end gap-3 pt-4">
            <button
              onClick={onCancel}
              className="px-4 py-2 border rounded-md hover:bg-gray-50"
            >
              Cancel
            </button>
            <button
              onClick={() => onConfirm(reassignTo || undefined, confirmVacancy)}
              disabled={!deleteResult.allowed || (hasImpactedRosters && !reassignTo && !confirmVacancy)}
              className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50"
            >
              Delete User
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============================================================================
// Role Management Components
// ============================================================================

/**
 * RoleForm - Create/Edit role modal
 */
interface RoleFormProps {
  role?: Role;
  onSubmit: (data: CreateRoleRequest | UpdateRoleRequest) => Promise<void>;
  onCancel: () => void;
  isOpen: boolean;
}

export function RoleForm({ role, onSubmit, onCancel, isOpen }: RoleFormProps) {
  const [formData, setFormData] = useState<CreateRoleRequest>({
    name: role?.name || '',
    description: role?.description || '',
    permissions: role?.permissions || [],
    defaultTaskPreferences: role?.defaultTaskPreferences || [],
    defaultExperienceLevel: role?.defaultExperienceLevel,
    defaultPPType: role?.defaultPPType
  });

  const [errors, setErrors] = useState<Record<string, string>>({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const togglePermission = (permission: Permission) => {
    setFormData(prev => ({
      ...prev,
      permissions: prev.permissions.includes(permission)
        ? prev.permissions.filter(p => p !== permission)
        : [...prev.permissions, permission]
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setErrors({});
    setIsSubmitting(true);

    try {
      await onSubmit(formData);
    } catch (error: any) {
      setErrors({ submit: error.message || 'Failed to save role' });
    } finally {
      setIsSubmitting(false);
    }
  };

  if (!isOpen) return null;

  const permissionGroups = {
    'User & Role Management': [
      Permission.CRUD_USER,
      Permission.CRUD_ROLE,
      Permission.VIEW_ALL_STAFF,
      Permission.VIEW_OWN_STAFF
    ],
    'Roster Management': [
      Permission.ASSIGN_SHIFT,
      Permission.CREATE_ROSTER,
      Permission.MODIFY_ROSTER,
      Permission.PUBLISH_ROSTER,
      Permission.DELETE_ROSTER,
      Permission.VIEW_ROSTER
    ],
    'Task Management': [
      Permission.ASSIGN_TASK,
      Permission.MODIFY_TASK
    ],
    'Settings & Configuration': [
      Permission.MANAGE_SETTINGS,
      Permission.MANAGE_SHIFT_DEFINITIONS,
      Permission.MANAGE_ROSTER_TEMPLATES
    ],
    'Export & Share': [
      Permission.EXPORT_ROSTER,
      Permission.SHARE_ROSTER
    ],
    'Audit & Reports': [
      Permission.VIEW_AUDIT_LOG,
      Permission.VIEW_REPORTS
    ],
    'Special': [
      Permission.DELETE_SM_USER,
      Permission.DEMOTE_SM_USER,
      Permission.MANAGE_AD_HOC_PP
    ]
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4">
            {role ? 'Edit Role' : 'Create New Role'}
          </h2>

          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Role Name *</label>
              <input
                type="text"
                value={formData.name}
                onChange={(e) => setFormData(prev => ({ ...prev, name: e.target.value }))}
                className="w-full px-3 py-2 border rounded-md"
                required
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-1">Description</label>
              <textarea
                value={formData.description || ''}
                onChange={(e) => setFormData(prev => ({ ...prev, description: e.target.value }))}
                className="w-full px-3 py-2 border rounded-md"
                rows={3}
              />
            </div>

            <div>
              <label className="block text-sm font-medium mb-2">Permissions</label>
              <div className="border rounded-md p-4 space-y-4">
                {Object.entries(permissionGroups).map(([group, perms]) => (
                  <div key={group}>
                    <h4 className="font-semibold mb-2">{group}</h4>
                    <div className="grid grid-cols-2 gap-2">
                      {perms.map(perm => (
                        <label key={perm} className="flex items-center space-x-2">
                          <input
                            type="checkbox"
                            checked={formData.permissions.includes(perm)}
                            onChange={() => togglePermission(perm)}
                            className="rounded"
                          />
                          <span className="text-sm">{perm.replace(/_/g, ' ')}</span>
                        </label>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {errors.submit && (
              <div className="text-red-600 text-sm">{errors.submit}</div>
            )}

            <div className="flex justify-end gap-3 pt-4">
              <button
                type="button"
                onClick={onCancel}
                className="px-4 py-2 border rounded-md hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                type="submit"
                disabled={isSubmitting}
                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
              >
                {isSubmitting ? 'Saving...' : role ? 'Update' : 'Create'}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

/**
 * PermissionMatrix - Visual permission matrix component
 */
interface PermissionMatrixProps {
  roles: Role[];
}

export function PermissionMatrix({ roles }: PermissionMatrixProps) {
  const allPermissions = Object.values(Permission);

  return (
    <div className="overflow-x-auto">
      <table className="min-w-full border-collapse border border-gray-300">
        <thead>
          <tr>
            <th className="border border-gray-300 px-4 py-2 text-left">Permission</th>
            {roles.map(role => (
              <th key={role.id} className="border border-gray-300 px-4 py-2 text-center">
                {role.name}
              </th>
            ))}
          </tr>
        </thead>
        <tbody>
          {allPermissions.map(permission => (
            <tr key={permission}>
              <td className="border border-gray-300 px-4 py-2 text-sm">
                {permission.replace(/_/g, ' ')}
              </td>
              {roles.map(role => (
                <td key={role.id} className="border border-gray-300 px-4 py-2 text-center">
                  {role.permissions.includes(permission) ? (
                    <span className="text-green-600">✓</span>
                  ) : (
                    <span className="text-gray-400">—</span>
                  )}
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

// ============================================================================
// Roster Components
// ============================================================================

/**
 * ShiftSlot - Individual shift slot component
 */
interface ShiftSlotProps {
  slot: RosterSlot & { user?: User };
  onAssign: (slotId: string) => void;
  onRemove: (slotId: string) => void;
  availableUsers: User[];
}

export function ShiftSlot({ slot, onAssign, onRemove, availableUsers }: ShiftSlotProps) {
  return (
    <div className="border rounded-lg p-3 bg-white">
      {slot.user ? (
        <div>
          <div className="flex justify-between items-start">
            <div>
              <p className="font-semibold">{slot.user.firstName} {slot.user.lastName}</p>
              <p className="text-sm text-gray-600">{slot.user.employeeId}</p>
            </div>
            <button
              onClick={() => onRemove(slot.id)}
              className="text-red-600 hover:text-red-800 text-sm"
            >
              Remove
            </button>
          </div>
          <div className="mt-2 text-xs text-gray-500">
            <p>Tasks: {slot.assignedTasks.length}</p>
            <p>Time: {slot.startTime} - {slot.endTime}</p>
          </div>
        </div>
      ) : (
        <button
          onClick={() => onAssign(slot.id)}
          className="w-full py-2 text-sm text-gray-500 border-2 border-dashed rounded hover:border-blue-500 hover:text-blue-500"
        >
          + Assign Staff
        </button>
      )}
    </div>
  );
}

/**
 * CoverageMeter - Visual coverage indicator
 */
interface CoverageMeterProps {
  coverage: {
    filledSlots: number;
    totalSlots: number;
    minRequired: number;
    percentage: number;
  };
}

export function CoverageMeter({ coverage }: CoverageMeterProps) {
  const isAdequate = coverage.percentage >= 100;
  const color = isAdequate ? 'bg-green-500' : coverage.percentage >= 80 ? 'bg-yellow-500' : 'bg-red-500';

  return (
    <div className="space-y-2">
      <div className="flex justify-between text-sm">
        <span>Coverage: {coverage.filledSlots}/{coverage.minRequired} required</span>
        <span className={isAdequate ? 'text-green-600' : 'text-red-600'}>
          {coverage.percentage.toFixed(0)}%
        </span>
      </div>
      <div className="w-full bg-gray-200 rounded-full h-2">
        <div
          className={`${color} h-2 rounded-full transition-all`}
          style={{ width: `${Math.min(coverage.percentage, 100)}%` }}
        />
      </div>
    </div>
  );
}

/**
 * ExportModal - Export roster modal
 */
interface ExportModalProps {
  isOpen: boolean;
  onClose: () => void;
  onExport: (format: 'csv' | 'pdf', options: any) => Promise<void>;
}

export function ExportModal({ isOpen, onClose, onExport }: ExportModalProps) {
  const [format, setFormat] = useState<'csv' | 'pdf'>('csv');
  const [dateRange, setDateRange] = useState({
    start: new Date().toISOString().split('T')[0],
    end: new Date().toISOString().split('T')[0]
  });
  const [options, setOptions] = useState({
    includeMetadata: true,
    includeTasks: true,
    includeContactInfo: false
  });

  const handleExport = async () => {
    await onExport(format, { dateRange, ...options });
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4">Export Roster</h2>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Format</label>
              <select
                value={format}
                onChange={(e) => setFormat(e.target.value as 'csv' | 'pdf')}
                className="w-full px-3 py-2 border rounded-md"
              >
                <option value="csv">CSV</option>
                <option value="pdf">PDF</option>
              </select>
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Start Date</label>
                <input
                  type="date"
                  value={dateRange.start}
                  onChange={(e) => setDateRange(prev => ({ ...prev, start: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">End Date</label>
                <input
                  type="date"
                  value={dateRange.end}
                  onChange={(e) => setDateRange(prev => ({ ...prev, end: e.target.value }))}
                  className="w-full px-3 py-2 border rounded-md"
                />
              </div>
            </div>
            <div className="space-y-2">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={options.includeMetadata}
                  onChange={(e) => setOptions(prev => ({ ...prev, includeMetadata: e.target.checked }))}
                  className="mr-2"
                />
                Include metadata
              </label>
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={options.includeTasks}
                  onChange={(e) => setOptions(prev => ({ ...prev, includeTasks: e.target.checked }))}
                  className="mr-2"
                />
                Include tasks
              </label>
              <label className="flex items-center">
                <input
                  type="checkbox"
                  checked={options.includeContactInfo}
                  onChange={(e) => setOptions(prev => ({ ...prev, includeContactInfo: e.target.checked }))}
                  className="mr-2"
                />
                Include contact info
              </label>
            </div>
            <div className="flex justify-end gap-3 pt-4">
              <button
                onClick={onClose}
                className="px-4 py-2 border rounded-md hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                onClick={handleExport}
                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
              >
                Export
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

/**
 * ShareModal - Share roster modal
 */
interface ShareModalProps {
  isOpen: boolean;
  onClose: () => void;
  onShare: (method: 'email' | 'slack', recipients: string[], message?: string) => Promise<void>;
}

export function ShareModal({ isOpen, onClose, onShare }: ShareModalProps) {
  const [method, setMethod] = useState<'email' | 'slack'>('email');
  const [recipients, setRecipients] = useState('');
  const [message, setMessage] = useState('');

  const handleShare = async () => {
    const recipientList = recipients.split(',').map(r => r.trim()).filter(Boolean);
    await onShare(method, recipientList, message || undefined);
    setRecipients('');
    setMessage('');
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-xl w-full max-w-md">
        <div className="p-6">
          <h2 className="text-2xl font-bold mb-4">Share Roster</h2>
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium mb-1">Method</label>
              <select
                value={method}
                onChange={(e) => setMethod(e.target.value as 'email' | 'slack')}
                className="w-full px-3 py-2 border rounded-md"
              >
                <option value="email">Email</option>
                <option value="slack">Slack</option>
              </select>
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">
                {method === 'email' ? 'Email Addresses' : 'Slack User IDs'} (comma-separated)
              </label>
              <input
                type="text"
                value={recipients}
                onChange={(e) => setRecipients(e.target.value)}
                className="w-full px-3 py-2 border rounded-md"
                placeholder={method === 'email' ? 'user@example.com, user2@example.com' : '@user1, @user2'}
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">Message (optional)</label>
              <textarea
                value={message}
                onChange={(e) => setMessage(e.target.value)}
                className="w-full px-3 py-2 border rounded-md"
                rows={3}
                placeholder="Add a message..."
              />
            </div>
            <div className="flex justify-end gap-3 pt-4">
              <button
                onClick={onClose}
                className="px-4 py-2 border rounded-md hover:bg-gray-50"
              >
                Cancel
              </button>
              <button
                onClick={handleShare}
                disabled={!recipients.trim()}
                className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50"
              >
                Share
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
